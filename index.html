<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Annotation Interface Study</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }








        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }








        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }




        .header {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }








        .content {
            padding: 40px;
        }








        .scenario-box {
            background: #f8f9ff;
            border-left: 4px solid #4facfe;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }


        /* <!-- MODIFICATION: Style for the scenario text --> */
        #scenarioText {
            font-weight: bold;
            text-align: center;
            font-size: 1.2em;
            color: #333;
            margin: 15px 0;
            line-height: 1.5;
        }


        .interface-container {
            background: white;
            border: 2px solid #e0e6ff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }








        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e6ff;
            border-radius: 4px;
            margin-bottom: 30px;
        }








        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border-radius: 4px;
            transition: width 0.3s ease;
        }








        /* Improved Consent Screen */
        .consent-screen {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }








        .consent-header {
            text-align: center;
            margin-bottom: 30px;
        }








        .consent-section {
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }








        .consent-highlight {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4facfe;
        }








        .consent-checkboxes {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #ffeaa7;
        }








        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }








        .checkbox-group input[type="checkbox"] {
            margin-top: 3px;
            transform: scale(1.3);
        }








        .checkbox-group label {
            line-height: 1.5;
            font-size: 14px;
        }








        /* Valence-Arousal Plot Improvements */
        .va-plot {
            width: 500px;
            height: 500px;
            position: relative;
            margin: 20px auto;
            border: 3px solid #333;
            border-radius: 8px;
        }








        .quadrant {
            position: absolute;
            width: 50%;
            height: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }








        .quadrant:hover {
            transform: scale(1.02);
            z-index: 5;
        }








        .quadrant.selected {
            border: 5px solid white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            transform: scale(1);
            z-index: 10;
        }








        .quadrant-title {
            font-size: 16px;
            margin-bottom: 8px;
        }








        .quadrant-examples {
            font-size: 12px;
            line-height: 1.3;
            opacity: 0.9;
        }








        .hanv { background: #e74c3c; top: 0; left: 0; } /* High Arousal, Negative Valence - Red */
        .hapv { background: #f39c12; top: 0; right: 0; } /* High Arousal, Positive Valence - Yellow */
        .lanv { background: #3498db; bottom: 0; left: 0; } /* Low Arousal, Negative Valence - Blue */
        .lapv { background: #27ae60; bottom: 0; right: 0; } /* Low Arousal, Positive Valence - Green */








        /* Slider Interface */
        .slider-interface {
            max-width: 600px;
            margin: 0 auto;
        }








        .slider-group {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }








        .slider-label {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }








        .slider-container {
            position: relative;
            margin: 20px 0;
        }








        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }








        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }








        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }








        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }








        .slider-value {
            text-align: center;
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #4facfe;
        }








        /* Emotion Labels */
        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }








        .emotion-btn {
            padding: 12px 16px;
            border: 2px solid #e0e6ff;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }








        .emotion-btn:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }








        .emotion-btn.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }








        /* Emotion Tree */
        .tree-container {
            text-align: center;
        }








        .tree-level {
            margin: 20px 0;
        }








        .breadcrumb {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }








        /* Metaphor Interface Style Improvements */
        .metaphor-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }








        .metaphor-item {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 4px solid transparent;
            transition: all 0.3s ease;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }








        .metaphor-item:hover {
            transform: scale(1.05);
        }








        .metaphor-item.selected {
            border-color: white;
            transform: scale(1.08);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }








        /* Emoji Interface */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 20px 0;
        }








        .emoji-item {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            border: 3px solid #e0e6ff;
            transition: all 0.3s ease;
            background: #f8f9ff;
            padding: 15px;
        }








        .emoji-item:hover {
            border-color: #4facfe;
            transform: scale(1.05);
            background: #e8f4fd;
        }








        .emoji-item.selected {
            border-color: #4facfe;
            background: #4facfe;
            color: white;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }








        .emoji-label {
            font-size: 14px;
            margin-top: 10px;
            font-weight: bold;
        }








        /* Simplified Rating Interface */
        .rating-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }








        .rating-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }








        .rating-row.rating-required-error {
            border: 2px solid #e74c3c;
            background-color: #fcebeb;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
        }








        .rating-stars {
            display: flex;
            gap: 8px;
            align-items: center;
        }








        .star {
            font-size: 28px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }








        .star.active {
            color: #ffd700;
        }








        .rating-labels {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #666;
        }








        /* Feelings Wheel Styles - Grid/Flexbox Design */
        .wheel-container {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }








        .wheel-level {
            margin: 20px 0;
            min-height: 200px; /* Reduced min-height */
            position: relative;
        }








        .core-emotions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            justify-content: center;
            max-width: 600px;
            margin: 0 auto;
        }








        .core-emotion {
            padding: 25px 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 3px solid transparent;
            aspect-ratio: 1; /* Makes it a circle */
        }








        .core-emotion:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }








        .core-emotion.selected {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            border: 3px solid white;
        }








        /* Colors for core emotions */
        .emotion-happy { background: #FFD700; }
        .emotion-sad { background: #4169E1; }
        .emotion-disgusted { background: #556b2f; }
        .emotion-angry { background: #DC143C; }
        .emotion-fearful { background: #483d8b; }
        .emotion-bad { background: #708090; }
        .emotion-surprised { background: #ff69b4; }








        .secondary-emotions-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
            max-width: 600px;
        }








        .secondary-emotion {
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }








        .secondary-emotion:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-color: white;
        }








        .secondary-emotion.selected {
            border-color: white;
            transform: scale(1.1);
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
        }








        .tertiary-emotions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 20px auto;
            padding: 20px;
            background: #e8f4fd;
            border-radius: 12px;
            max-width: 600px;
        }








        .tertiary-emotion {
            padding: 10px 14px;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 13px;
            border: 2px solid #e0e6ff;
        }








        .tertiary-emotion:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }








        .tertiary-emotion.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }








        .wheel-breadcrumb {
            margin: 20px 0;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
            font-weight: bold;
        }








        /* MODIFICATION: Styles for new Contextual Factors interface */
        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }








        .context-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            gap: 10px;
            background: white;
            border: 2px solid #e0e6ff;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }








        .context-icon {
            font-size: 32px;
            margin-bottom: 5px;
        }








        .context-label {
            font-size: 14px;
            font-weight: 600;
        }
        
        .context-item:hover {
            border-color: #4facfe;
            background: #f0f8ff;
            transform: translateY(-2px);
        }
        
        .context-item.selected {
            border-color: #4facfe;
            background: #e8f4fd;
            box-shadow: 0 4px 8px rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }








        /* Form Elements */
        .input-group {
            margin: 20px 0;
        }








        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }








        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            font-size: 14px;
        }








        .input-group textarea {
            height: 100px;
            resize: vertical;
        }








        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }








        .btn-primary {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }








        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(79, 172, 254, 0.3);
        }








        .btn-secondary {
            background: #6c757d;
            color: white;
        }








        .hidden {
            display: none;
        }








        .intensity-slider {
            width: 100%;
            margin: 20px 0;
        }








        /* Center content styles */
        .centered-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }








        .step-indicator {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2c5282;
        }








        /* Final Feedback Screen Styles */
        .feedback-screen {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }








        .interface-comparison {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4facfe;
        }








        .interface-ranking {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }








        .ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px solid #e0e6ff;
        }








        .ranking-number {
            background: #4facfe;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }








        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }








        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e6ff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }








        .radio-item:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }








        .radio-item input[type="radio"]:checked + .radio-item,
        .radio-item:has(input[type="radio"]:checked) {
            border-color: #4facfe;
            background: #e8f4fd;
        }
        
        /* =================================== */
        /*          RESPONSIVE STYLES          */
        /* =================================== */


        /* For tablets and smaller devices */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }


            .container {
                padding: 0;
            }


            .header {
                padding: 20px;
                border-top-left-radius: 0;
                border-top-right-radius: 0;
            }


            .content {
                padding: 20px;
            }


            h1 {
                font-size: 1.8em;
            }


            h2 {
                font-size: 1.5em;
            }


            /* VA Plot responsiveness */
            .va-plot {
                width: 100%;
                max-width: 450px; /* Prevent it from getting too big on tablets */
                height: auto;
                aspect-ratio: 1 / 1;
            }


            .quadrant-title {
                font-size: 1em;
            }
            
            .quadrant-examples {
                font-size: 0.8em;
            }
            
            /* Grid responsiveness */
            .metaphor-grid,
            .emoji-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .emoji-item {
                font-size: 40px;
                padding: 10px;
            }
            
            /* Rating rows */
            .rating-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .rating-stars {
                flex-wrap: wrap; 
                justify-content: center;
                width: 100%;
            }


            /* Feelings Wheel */
            .core-emotions-grid {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 10px;
            }


            .secondary-emotions-grid {
                gap: 8px;
            }
            
            .secondary-emotion {
                padding: 8px 16px;
            }


            /* Final feedback radio buttons */
            .radio-group .radio-item {
                width: 100%;
                box-sizing: border-box;
            }
        }


        /* For mobile phones */
        @media (max-width: 480px) {
            body {
                padding: 0;
            }


            .container {
                border-radius: 0;
                min-height: 100vh;
                box-shadow: none;
            }


            .content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            .header p {
                font-size: 0.9em;
            }


            .scenario-box {
                padding: 15px;
            }
            
            /* Consent screen adjustments */
            .consent-screen, .feedback-screen, .interface-container {
                padding: 15px;
            }
            .consent-section {
                padding: 15px 10px;
            }
            
            /* VA Plot fonts */
            .quadrant-title {
                font-size: 0.9em;
            }
            .quadrant-examples {
                font-size: 0.75em;
                line-height: 1.2;
            }


            /* Sliders */
            .slider-labels {
                font-size: 12px;
            }
            .slider-labels span:nth-child(2) {
                display: none; /* Hide the middle label on very small screens to prevent crowding */
            }


            /* Contextual Factors Grid */
            .context-grid {
                grid-template-columns: repeat(2, 1fr); /* Force 2 columns on small mobile */
                gap: 10px;
            }
            .context-item {
                padding: 10px;
            }
            .context-icon {
                font-size: 28px;
            }
            
            /* Buttons */
            .btn {
                padding: 14px 20px;
                font-size: 16px;
                width: 100%; /* Make main navigation buttons full-width */
                margin: 8px 0;
                box-sizing: border-box;
            }
            
            /* Stack back/next buttons */
            #backBtn, #nextBtn {
                display: block; 
            }
            #backBtn + #nextBtn {
                margin-top: 0;
            }
            
            /* Make text inputs and selects more mobile friendly */
            .input-group input, .input-group textarea, .input-group select {
                padding: 14px;
                font-size: 16px; /* Prevents iOS auto-zoom on focus */
            }


            /* Ensure emoji label is readable */
            .emoji-label {
                font-size: 12px;
            }
            
            /* Demographics form */
            .input-group label {
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Emotion Annotation Interface Study</h1>
            <p>Help us understand which interface works best for daily emotion logging</p>
        </div>








        <div class="content">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>








            <!-- Consent Screen (Now First) -->
            <div id="consentScreen">
                <div class="consent-screen">
                    <div class="consent-header">
                        <h2>üìã Research Participation Information</h2>
                        <p style="font-size: 16px; color: #666; margin-top: 10px;">
                            Before we begin, please read the following information about this study
                        </p>
                    </div>








                    <div class="consent-section">
                        <h3>üìù What will you do in this study?</h3>
                        <div class="consent-highlight">
                            <p><strong>Step 1:</strong> Read everyday scenarios that can influence your mood.</p>
                            <!-- MODIFICATION -->
                            <p><strong>Step 2:</strong> Try 10 different ways to log how those scenarios would make you feel.</p>
                            <p><strong>Step 3:</strong> Rate each interface on how easy it was to use and how well it captured your emotions.</p>
                            <p><strong>Step 4:</strong> Share any additional thoughts or feedback.</p>
                        </div>
                        <p>You'll experience interfaces like emotion labels, visual maps, sliders, emojis, feelings wheel, and metaphor-based selection. There are no right or wrong answers - we want your honest experience!</p>
                    </div>








                    <div class="consent-section">
                        <h3>üéØ What is this study about?</h3>
                        <p>We are researching different ways people can log their emotions digitally. Your feedback will help us design better emotion tracking tools for apps and digital wellness platforms.</p>
                    </div>








                    <div class="consent-section">
                        <h3>‚è±Ô∏è How long will this take?</h3>
                        <p>Approximately <strong>15-20 minutes</strong> of your time.</p>
                    </div>








                    <div class="consent-section">
                        <h3>üîí Your Privacy & Data</h3>
                        <div class="consent-highlight">
                            <p><strong>‚úì Completely Anonymous:</strong> We don't collect any personal information that can identify you</p>
                            <p><strong>‚úì Research Only:</strong> Your responses will only be used for academic research</p>
                            <p><strong>‚úì Secure Storage:</strong> All data is stored safely and will be deleted after the research is complete</p>
                            <p><strong>‚úì No Sharing:</strong> Your individual responses will never be shared with anyone outside our research team</p>
                        </div>
                    </div>








                    <div class="consent-section">
                        <h3>üö™ Your Rights</h3>
                        <p><strong>Voluntary Participation:</strong> You can stop participating at any time without any consequences.</p>
                        <p><strong>No Right or Wrong Answers:</strong> We want your honest experience and opinions.</p>
                        <p><strong>Questions:</strong> You can contact our research team if you have any concerns.</p>
                    </div>








                    <div class="consent-checkboxes">
                        <h3 style="margin-bottom: 20px;">‚úÖ Please confirm to continue:</h3>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="consentCheck" required>
                            <label for="consentCheck">
                                <strong>I understand and agree to participate</strong><br>
                                I have read the information above and voluntarily agree to participate in this research study.
                            </label>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="ageConfirm" required>
                            <label for="ageConfirm">
                                <strong>Age confirmation</strong><br>
                                I confirm that I am 18 years of age or older.
                            </label>
                        </div>
                    </div>








                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="proceedToDemographics()">I Agree - Continue</button>
                    </div>
                </div>
            </div>








            <!-- Demographics Screen (Now Second) -->
            <div id="demographicsScreen" class="hidden">
                <h2>About You</h2>
                <p>This information helps us understand how different people prefer different interfaces. All responses are confidential.</p>
                <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
                    <strong>Privacy Note:</strong> This information is for research purposes only and will be kept confidential.
                </p>
                
                <div class="input-group">
                    <label>Your Name (optional):</label>
                    <input type="text" id="userName" placeholder="Enter your name (optional)">
                </div>








                <div class="input-group">
                    <label>Email Address: <span style="color: red;">*</span></label>
                    <input type="email" id="userEmail" placeholder="Enter your email address" required>
                </div>
                
                <div class="input-group">
                    <label>Age Range: <span style="color: red;">*</span></label>
                    <select id="ageRange" required>
                        <option value="">Select age range</option>
                        <option value="18-25">18-25</option>
                        <option value="26-35">26-35</option>
                        <option value="36-45">36-45</option>
                        <option value="46-55">46-55</option>
                        <option value="55+">55+</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Gender: <span style="color: red;">*</span></label>
                    <select id="gender" onchange="toggleOtherField('gender', 'genderOther')" required>
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Non-binary">Non-binary</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="genderOther" placeholder="Please specify" style="margin-top: 8px; display: none;">
                </div>
                
                <div class="input-group">
                    <label>Highest Education Level: <span style="color: red;">*</span></label>
                    <select id="education" onchange="toggleOtherField('education', 'educationOther')" required>
                        <option value="">Select education level</option>
                        <option value="High School">High School (12th standard)</option>
                        <option value="Diploma">Diploma</option>
                        <option value="Bachelor's">Bachelor's Degree</option>
                        <option value="Master's">Master's Degree</option>
                        <option value="PhD">PhD/Doctorate</option>
                        <option value="Professional">Professional Degree (CA, CS, etc.)</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="educationOther" placeholder="Please specify your education level" style="margin-top: 8px; display: none;">
                </div>
                
                <div class="input-group">
                    <label>Occupation: <span style="color: red;">*</span></label>
                    <select id="occupation" onchange="toggleOtherField('occupation', 'occupationOther')" required>
                        <option value="">Select occupation</option>
                        <option value="Student">Student</option>
                        <option value="Software Engineer">Software Engineer/IT Professional</option>
                        <option value="Manager">Manager/Executive</option>
                        <option value="Doctor">Doctor/Healthcare</option>
                        <option value="Teacher">Teacher/Professor</option>
                        <option value="Engineer">Engineer (Non-IT)</option>
                        <option value="Consultant">Consultant</option>
                        <option value="Entrepreneur">Entrepreneur/Business Owner</option>
                        <option value="Finance">Finance/Banking</option>
                        <option value="Government">Government Employee</option>
                        <option value="Freelancer">Freelancer</option>
                        <option value="Homemaker">Homemaker</option>
                        <option value="Retired">Retired</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="occupationOther" placeholder="Please specify your occupation" style="margin-top: 8px; display: none;">
                </div>
                
                <div class="input-group">
                    <label>Previous Experience with Mood/Emotion Tracking: <span style="color: red;">*</span></label>
                    <select id="trackingExperience" required>
                        <option value="">Select your experience</option>
                        <option value="None">Never used any mood/emotion tracking</option>
                        <option value="Apps - Basic">Used mood tracking apps (like Daylio, Mood Meter)</option>
                        <option value="Journal - Manual">Manual mood journaling (diary, notebook)</option>
                        <option value="Wearable">Used wearable devices for mood tracking</option>
                        <option value="Clinical">Clinical mood tracking (prescribed by doctor/therapist)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Mental Health Background: <span style="color: red;">*</span></label>
                    <p style="font-size: 12px; color: #666; margin-bottom: 8px;">This information helps us understand different user needs. All responses are confidential.</p>
                    <select id="mentalHealth" required>
                        <option value="">Select the most appropriate option</option>
                        <option value="No history">No mental health concerns or history</option>
                        <option value="Self-reported concerns">Self-identified mental health concerns (not formally diagnosed)</option>
                        <option value="Diagnosed - not treated">Formally diagnosed but not currently in treatment</option>
                        <option value="Diagnosed - medication">Diagnosed and taking medication</option>
                        <option value="Therapy - current">Currently in therapy/counseling</option>
                        <option value="Therapy - past">Previously had therapy/counseling</option>
                        <option value="Therapy and medication">Currently in therapy and taking medication</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                        <span style="color: red;">*</span> Required fields
                    </p>
                    <button class="btn btn-secondary" onclick="goBackToConsent()">Back</button>
                    <button class="btn btn-primary" onclick="proceedToStudy()">Continue to Study</button>
                </div>
            </div>








            <!-- Main Interface Container -->
            <div id="mainInterface" class="hidden">
                <!-- Scenario Display -->
                <div class="scenario-box" id="scenarioBox">
                    <h3>Scenario:</h3>
                    <p id="scenarioText"></p>
                    <div style="margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #4facfe;">
                        <h4 style="margin-bottom: 8px; color: #2c5282;">How would you feel in this situation?</h4>
                        <p style="color: #4a5568; font-style: italic;">Take a moment to imagine yourself in this situation, then click the button below to log your emotion.</p>
                    </div>
                </div>


                <!-- MODIFICATION: Button to reveal the interface --> 
                <div id="revealInterfaceBtnContainer" style="text-align: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showTaskInterface()">I'm Ready - Start Task</button>
                </div>




                <!-- Interface Name (initially hidden) -->
                <h2 id="interfaceName" style="text-align: center; margin-bottom: 20px;" class="hidden"></h2>








                <!-- Interface Container (initially hidden) -->
                <div class="interface-container hidden" id="interfaceContainer">
                    <!-- Content will be dynamically loaded -->
                </div>








                <!-- Rating Section -->
                <div class="rating-section" id="ratingSection" style="display: none;">
                    <h3>Rate This Interface</h3>
                    <div class="rating-row">
                        <span style="font-weight: bold;">Ease of Use:</span>
                        <div class="rating-stars" data-rating="ease">
                            <span class="rating-labels">Very Hard</span>
                            <span class="star" data-value="1">‚òÖ</span>
                            <span class="star" data-value="2">‚òÖ</span>
                            <span class="star" data-value="3">‚òÖ</span>
                            <span class="star" data-value="4">‚òÖ</span>
                            <span class="star" data-value="5">‚òÖ</span>
                            <span class="rating-labels">Very Easy</span>
                        </div>
                    </div>
                    <div class="rating-row">
                        <span style="font-weight: bold;">Accuracy (how well it captured your emotion):</span>
                        <div class="rating-stars" data-rating="accuracy">
                            <span class="rating-labels">Very Poor</span>
                            <span class="star" data-value="1">‚òÖ</span>
                            <span class="star" data-value="2">‚òÖ</span>
                            <span class="star" data-value="3">‚òÖ</span>
                            <span class="star" data-value="4">‚òÖ</span>
                            <span class="star" data-value="5">‚òÖ</span>
                            <span class="rating-labels">Excellent</span>
                        </div>
                    </div>
                    <div class="rating-row">
                        <span style="font-weight: bold;">Overall Preference:</span>
                        <div class="rating-stars" data-rating="preference">
                            <span class="rating-labels">Dislike</span>
                            <span class="star" data-value="1">‚òÖ</span>
                            <span class="star" data-value="2">‚òÖ</span>
                            <span class="star" data-value="3">‚òÖ</span>
                            <span class="star" data-value="4">‚òÖ</span>
                            <span class="star" data-value="5">‚òÖ</span>
                            <span class="rating-labels">Love</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="interfaceLikes">What did you like about this interface?</label>
                        <textarea id="interfaceLikes" placeholder="e.g., It was fast, it felt accurate, the colors were nice..."></textarea>
                    </div>
                    <div class="input-group">
                        <label for="interfaceDislikes">What was missing or interfered with your expression?</label>
                        <textarea id="interfaceDislikes" placeholder="e.g., I couldn't find the exact word, it was too simple/complex, I felt mixed emotions..."></textarea>
                    </div>
                </div>








                <!-- Navigation Buttons (initially hidden by JS) -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" id="backBtn" onclick="previousStep()">Back</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Continue</button>
                </div>
            </div>








            <!-- Final Feedback Screen -->
            <div id="finalFeedbackScreen" class="hidden">
                <div class="feedback-screen">
                    <div class="consent-header">
                        <h2>üéØ Final Feedback</h2>
                        <p style="font-size: 16px; color: #666; margin-top: 10px;">
                            Now that you've tried all the interfaces, please share your overall thoughts
                        </p>
                    </div>








                    <div class="interface-comparison">
                        <h3>üìä Interface Comparison</h3>
                        <p>You tested these 10 emotion annotation interfaces:</p>
                        <div id="interfaceList"></div>
                    </div>








                    <div class="interface-comparison">
                        <h3>ü•á Best Interface Overall</h3>
                        <label><strong>Which interface would you prefer to use for daily emotion logging?</strong></label>
                        <div class="radio-group" id="bestInterfaceGroup">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üí≠ Why This Interface?</h3>
                        <div class="input-group">
                            <label>Please explain why you chose this interface as your favorite:</label>
                            <textarea id="bestInterfaceReason" placeholder="What made this interface stand out? Consider ease of use, accuracy, speed, intuitiveness, etc."></textarea>
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üëé Least Preferred Interface</h3>
                        <label><strong>Which interface would you least like to use?</strong></label>
                        <div class="radio-group" id="worstInterfaceGroup">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üí≠ Why Avoid This Interface?</h3>
                        <div class="input-group">
                            <label>Please explain why you found this interface least appealing:</label>
                            <textarea id="worstInterfaceReason" placeholder="What made this interface difficult or frustrating to use?"></textarea>
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üöÄ Future Improvements</h3>
                        <div class="input-group">
                            <label>What would make emotion tracking interfaces better in general?</label>
                            <textarea id="generalImprovements" placeholder="Any suggestions for new features, combinations of interfaces, or completely different approaches?"></textarea>
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üì± Usage Context</h3>
                        <label><strong>In what situation would you most likely use emotion tracking?</strong></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="daily-routine" id="daily-routine">
                                <label for="daily-routine">Daily routine (morning/evening check-ins)</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="stress-management" id="stress-management">
                                <label for="stress-management">Stress/anxiety management</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="therapy-support" id="therapy-support">
                                <label for="therapy-support">Mental health therapy support</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="self-awareness" id="self-awareness">
                                <label for="self-awareness">Personal self-awareness</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="mood-patterns" id="mood-patterns">
                                <label for="mood-patterns">Tracking mood patterns</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="usageContext" value="research" id="research">
                                <label for="research">Research participation</label>
                            </div>
                        </div>
                    </div>








                    <div class="interface-comparison">
                        <h3>üìù Additional Comments</h3>
                        <div class="input-group">
                            <label>Any other thoughts about this study or emotion tracking in general?</label>
                            <textarea id="additionalComments" placeholder="Share any other feedback, suggestions, or experiences..."></textarea>
                        </div>
                    </div>








                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="goBackToMainInterface()">Back to Interfaces</button>
                        <button class="btn btn-primary" onclick="submitFinalFeedback()">Complete Study</button>
                    </div>
                </div>
            </div>








            <!-- Results Screen -->
            <div id="resultsScreen" class="hidden">
                <div class="centered-content" id="resultsContent">
                    <h2>üéâ Thank You!</h2>
                    <p>Your responses have been recorded. This data will help improve emotion tracking interfaces.</p>
                </div>
            </div>
        </div>
    </div>




    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";




        const firebaseConfig = {
            apiKey: "AIzaSyDIt-ChXmC_ToTZloYckBWcNFO3tmvcnbc",
            authDomain: "annosense-ui.firebaseapp.com",
            projectId: "annosense-ui",
            storageBucket: "annosense-ui.appspot.com", // Corrected domain
            messagingSenderId: "674765046133",
            appId: "1:674765046133:web:007c8ae575ed8e57ab533c",
            measurementId: "G-YXY0LTMNNY"
        };




        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);




        // Global Variables
        let currentStep = 0;
        let currentInterface = 0;
        let surveyData = {
            userInfo: {},
            responses: [],
            finalFeedback: {},
            startTime: Date.now()
        };








        // List of 6 core scenarios, made more generic to be relatable to any adult.
        const coreScenarios = [
            "You receive some surprisingly wonderful news that you weren't expecting at all, instantly brightening your day.", // Happiness
            "You realize that you have lost something that was very important and held a lot of sentimental value to you.", // Sadness
            "You're waiting for something important, and you experience a significant and unfair delay or cancellation due to someone else's mistake.", // Anger
            "While you are walking, a car unexpectedly speeds through a stop sign you were about to cross, missing you by only a few feet.", // Fear
            "You take a sip of a drink, expecting a familiar taste, but instead, you are met with a spoiled, sour, or foul flavor.", // Disgust
            "While cleaning or tidying up, you find something of value (either sentimental or monetary) that you were convinced you had lost forever." // Surprise
        ];
















        // Updated Interface definitions
        const interfaces = [
            {
                name: "Basic Emotion Labels",
                type: "basic_labels",
                description: "Select emotions using simple labels"
            },
            {
                name: "Emotional Space - Technical Terms",
                type: "va_technical",
                description: "Click on the emotional space map using technical terms"
            },
            {
                name: "Emotional Space - Simple Language", // <-- REVERTED NAME
                type: "va_simple",
                description: "Click on the emotional space map using everyday language"
            },
            {
                name: "Emotion Sliders",
                type: "emotion_sliders",
                description: "Use sliders to define your emotional state"
            },
            {
                name: "Emotion Tree Navigation",
                type: "emotion_tree",
                description: "Navigate from basic to nuanced emotions"
            },
            {
                name: "Visual Metaphors",
                type: "metaphor",
                description: "Choose emotions through weather, colors, and symbols"
            },
            {
                name: "Emoji Selection",
                type: "emoji",
                description: "Select emotions using emojis"
            },
            {
                name: "Feelings Wheel",
                type: "feelings_wheel",
                description: "Navigate emotions using the Feelings Wheel"
            },
            {
                name: "Journaling (ABC)",
                type: "journaling_abc",
                description: "Log emotions using the A-B-C journaling technique"
            },
            {
                name: "Contextual Factors",
                type: "contextual_factors",
                description: "Link your emotion to activities, people, and places"
            }
        ];








        // Randomize interface order
        let shuffledInterfaces = [...interfaces].sort(() => Math.random() - 0.5);
        
        // Create a randomized list of scenarios for this session (6 unique + 4 repeats)
        const shuffledCoreScenarios = [...coreScenarios].sort(() => Math.random() - 0.5);
        const sessionTaskScenarios = [
            ...shuffledCoreScenarios,
            ...shuffledCoreScenarios.slice(0, 4) // Repeat the first 4 of the shuffled list to make 10 total scenarios
        ];








        // Navigation Functions
        window.proceedToDemographics = function() {
            const consentCheck = document.getElementById('consentCheck');
            const ageConfirm = document.getElementById('ageConfirm');
            
            if (!consentCheck.checked) {
                alert('Please provide your consent to participate in this research study.');
                return;
            }
            
            if (!ageConfirm.checked) {
                alert('Please confirm that you are 18 years of age or older.');
                return;
            }
            
            surveyData.userInfo.consentGiven = true;
            surveyData.userInfo.ageConfirmed = true;
            surveyData.userInfo.consentTime = new Date().toISOString();
            
            document.getElementById('consentScreen').classList.add('hidden');
            document.getElementById('demographicsScreen').classList.remove('hidden');
        }
        
        window.goBackToConsent = function() {
            document.getElementById('demographicsScreen').classList.add('hidden');
            document.getElementById('consentScreen').classList.remove('hidden');
        }
        
        window.proceedToStudy = function() {
            // Validate required fields
            const requiredFields = [
                { id: 'ageRange', name: 'Age Range' },
                { id: 'gender', name: 'Gender' },
                { id: 'education', name: 'Education Level' },
                { id: 'occupation', name: 'Occupation' },
                { id: 'trackingExperience', name: 'Tracking Experience' },
                { id: 'mentalHealth', name: 'Mental Health Background' },
                { id: 'userEmail', name: 'Email Address' }
            ];
            
            let missingFields = [];
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value) {
                    missingFields.push(field.name);
                    element.style.borderColor = '#ff6b6b';
                } else {
                    element.style.borderColor = '#e0e6ff';
                }
            });
            
            // Check "Other" fields if selected
            const otherFields = [
                { selectId: 'gender', inputId: 'genderOther', name: 'Gender specification' },
                { selectId: 'education', inputId: 'educationOther', name: 'Education specification' },
                { selectId: 'occupation', inputId: 'occupationOther', name: 'Occupation specification' }
            ];
            
            otherFields.forEach(field => {
                const select = document.getElementById(field.selectId);
                const input = document.getElementById(field.inputId);
                if (select.value === 'Other' && !input.value.trim()) {
                    missingFields.push(field.name);
                    input.style.borderColor = '#ff6b6b';
                } else {
                    input.style.borderColor = '#e0e6ff';
                }
            });
            
            if (missingFields.length > 0) {
                alert(`Please fill in the following required fields:\n‚Ä¢ ${missingFields.join('\n‚Ä¢ ')}`);
                return;
            }
            
            // Store demographic data
            function getFieldValue(selectId, inputId) {
                const select = document.getElementById(selectId);
                const input = document.getElementById(inputId);
                return select.value === 'Other' ? input.value.trim() : select.value;
            }
            
            surveyData.userInfo = {
                ...surveyData.userInfo,
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                ageRange: document.getElementById('ageRange').value,
                gender: getFieldValue('gender', 'genderOther'),
                education: getFieldValue('education', 'educationOther'),
                occupation: getFieldValue('occupation', 'occupationOther'),
                trackingExperience: document.getElementById('trackingExperience').value,
                mentalHealth: document.getElementById('mentalHealth').value,
                demographicsCompleted: new Date().toISOString(),
                studyStartTime: new Date().toISOString()
            };
            
            // Start the actual survey
            document.getElementById('demographicsScreen').classList.add('hidden');
            document.getElementById('mainInterface').classList.remove('hidden');
            
            loadInterface();
        }








        // Toggle Other Input Fields
        window.toggleOtherField = function(selectId, inputId) {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            
            if (select.value === 'Other') {
                input.style.display = 'block';
                input.required = true;
            } else {
                input.style.display = 'none';
                input.required = false;
                input.value = '';
            }
        }








        function loadInterface() {
            updateProgress();
            
            if (currentInterface >= shuffledInterfaces.length) {
                showFinalFeedback();
                return;
            }


            const interfaceDef = shuffledInterfaces[currentInterface];
            const scenario = sessionTaskScenarios[currentInterface];
            
            // Set scenario text
            document.getElementById('scenarioText').textContent = scenario;


            // <!-- MODIFICATION: Set the initial view state for the task -->
            // Hide the actual interface, its name, and the main navigation buttons
            document.getElementById('interfaceName').classList.add('hidden');
            document.getElementById('interfaceContainer').classList.add('hidden');
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('ratingSection').style.display = 'none';


            // Show the "Start Task" button
            document.getElementById('revealInterfaceBtnContainer').classList.remove('hidden');


            // Reset interface state from previous task
            currentStep = 0;
            document.getElementById('nextBtn').textContent = 'Continue';
            
            // Load the specific interface content into the hidden container
            loadSpecificInterface(interfaceDef);


            // Scroll to the top of the main interface area
            document.getElementById('mainInterface').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }


        // <!-- MODIFICATION: New function to show the interface after user is ready -->
        window.showTaskInterface = function() {
            // Hide the "Start Task" button
            document.getElementById('revealInterfaceBtnContainer').classList.add('hidden');


            // Show the interface name, the container, and the 'Continue' button
            document.getElementById('interfaceName').classList.remove('hidden');
            document.getElementById('interfaceContainer').classList.remove('hidden');
            document.getElementById('nextBtn').style.display = 'inline-block'; // Or 'block' for mobile
        }




        function loadSpecificInterface(interfaceDef) {
            const container = document.getElementById('interfaceContainer');
            
            switch(interfaceDef.type) {
                case 'basic_labels':
                    container.innerHTML = createBasicLabelsInterface();
                    break;
                case 'va_technical':
                    container.innerHTML = createVATechnicalInterface();
                    break;
                case 'va_simple':
                    container.innerHTML = createVASimpleInterface();
                    break;
                case 'emotion_sliders':
                    container.innerHTML = createEmotionSlidersInterface();
                    setupSliders();
                    break;
                case 'emotion_tree':
                    container.innerHTML = createEmotionTreeInterface();
                    setupEmotionTree();
                    break;
                case 'metaphor':
                    container.innerHTML = createMetaphorInterface();
                    setupMetaphorInterface();
                    break;
                case 'emoji':
                    container.innerHTML = createEmojiInterface();
                    break;
                case 'feelings_wheel':
                    container.innerHTML = createFeelingsWheelInterface();
                    setupFeelingsWheel();
                    break;
                case 'journaling_abc':
                    container.innerHTML = createJournalingABCInterface();
                    break;
                case 'contextual_factors':
                    container.innerHTML = createContextualFactorsInterface();
                    break;
            }
        }
















        function createBasicLabelsInterface() {
            const emotions = ['Happy', 'Sad', 'Angry', 'Anxious', 'Excited', 'Calm', 'Frustrated', 'Content', 'Worried', 'Joyful', 'Disappointed', 'Relaxed'];
            
            return `
                <div class="emotion-grid">
                    ${emotions.map(emotion => 
                        `<button class="emotion-btn" onclick="toggleEmotion(this, '${emotion}')">${emotion}</button>`
                    ).join('')}
                </div>
                <div class="intensity-slider">
                    <label>How strong is your emotion? Move the slider to pick a level from 1 to 10.</label>
                    <input type="range" class="slider" id="intensitySlider" min="1" max="10" value="5" oninput="updateIntensityValue()">
                    <div class="slider-value" id="intensityValue">5</div>
                </div>
            `;
        }
































































        function createVATechnicalInterface() {
            return `
                <div style="background: #e8f4fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4>Understanding Emotional Dimensions:</h4>
                    <p><strong>Arousal:</strong> How much energy or activation you feel (high = excited/agitated, low = calm/sleepy)</p>
                    <p><strong>Valence:</strong> How positive or negative you feel (positive = good/pleasant, negative = bad/unpleasant)</p>
                    <p style="margin-top: 10px; font-style: italic;">Click on the quadrant that best represents your emotional state</p>
                </div>
                <div class="va-plot" id="vaTechnicalPlot">
                    <div class="quadrant hanv" data-quadrant="hanv" onclick="selectQuadrant(this, 'vaTechnicalPlot')">
                        <div class="quadrant-title">High Arousal + Negative Valence</div>
                        <div class="quadrant-examples"><br>Angry ‚Ä¢ Frustrated<br>Anxious ‚Ä¢ Panicked<br>Enraged ‚Ä¢ Stressed</div>
                    </div>
                    <div class="quadrant hapv" data-quadrant="hapv" onclick="selectQuadrant(this, 'vaTechnicalPlot')">
                        <div class="quadrant-title">High Arousal + Positive Valence</div>
                        <div class="quadrant-examples"><br>Excited ‚Ä¢ Thrilled<br>Energetic ‚Ä¢ Elated<br>Enthusiastic ‚Ä¢ Joyful</div>
                    </div>
                    <div class="quadrant lanv" data-quadrant="lanv" onclick="selectQuadrant(this, 'vaTechnicalPlot')">
                        <div class="quadrant-title">Low Arousal + Negative Valence</div>
                        <div class="quadrant-examples"><br>Sad ‚Ä¢ Depressed<br>Tired ‚Ä¢ Lonely<br>Disappointed ‚Ä¢ Bored</div>
                    </div>
                    <div class="quadrant lapv" data-quadrant="lapv" onclick="selectQuadrant(this, 'vaTechnicalPlot')">
                        <div class="quadrant-title">Low Arousal + Positive Valence</div>
                        <div class="quadrant-examples"><br>Calm ‚Ä¢ Content<br>Relaxed ‚Ä¢ Peaceful<br>Satisfied ‚Ä¢ Serene</div>
                    </div>
                </div>
            `;
        }
































































        // REVERTED this function to its original state
        function createVASimpleInterface() {
            return `
                <p style="text-align: center; margin-bottom: 20px;">Click on the area that best represents how you feel</p>
                <div class="va-plot" id="vaSimplePlot">
                    <div class="quadrant hanv" data-quadrant="hanv" onclick="selectQuadrant(this, 'vaSimplePlot')">
                        <div class="quadrant-title">High Energy + Negative Feelings</div>
                        <div class="quadrant-examples">Angry ‚Ä¢ Frustrated<br>Anxious ‚Ä¢ Stressed<br>Agitated ‚Ä¢ Upset<br>Overwhelmed</div>
                    </div>
                    <div class="quadrant hapv" data-quadrant="hapv" onclick="selectQuadrant(this, 'vaSimplePlot')">
                        <div class="quadrant-title">High Energy + Positive Feelings</div>
                        <div class="quadrant-examples">Excited ‚Ä¢ Happy<br>Energetic ‚Ä¢ Joyful<br>Enthusiastic ‚Ä¢ Thrilled<br>Pumped Up</div>
                    </div>
                    <div class="quadrant lanv" data-quadrant="lanv" onclick="selectQuadrant(this, 'vaSimplePlot')">
                        <div class="quadrant-title">Low Energy + Negative Feelings</div>
                        <div class="quadrant-examples">Sad ‚Ä¢ Tired<br>Lonely ‚Ä¢ Down<br>Disappointed ‚Ä¢ Bored<br>Unmotivated</div>
                    </div>
                    <div class="quadrant lapv" data-quadrant="lapv" onclick="selectQuadrant(this, 'vaSimplePlot')">
                        <div class="quadrant-title">Low Energy + Positive Feelings</div>
                        <div class="quadrant-examples">Calm ‚Ä¢ Content<br>Relaxed ‚Ä¢ Peaceful<br>Satisfied ‚Ä¢ At ease<br>Comfortable</div>
                    </div>
                </div>
            `;
        }
































        function createEmotionSlidersInterface() {
            return `
                <div class="slider-interface">
                    <div class="slider-group">
                        <div class="slider-label">How do you feel? (Positive vs Negative)</div>
                        <div class="slider-container">
                            <input type="range" class="slider" id="happySlider" min="-50" max="50" value="0" oninput="updateSliderValue('happy')">
                            <div class="slider-labels">
                                <span>Very Negative</span>
                                <span>Neutral</span>
                                <span>Very Positive</span>
                            </div>
                            <div class="slider-value" id="happyValue">Neutral</div>
                        </div>
                    </div>
                    
                    <div class="slider-group">
                        <div class="slider-label">How intense is this feeling?</div>
                        <div class="slider-container">
                            <input type="range" class="slider" id="intensitySliderMain" min="0" max="100" value="50" oninput="updateSliderValue('intensity')">
                            <div class="slider-labels">
                                <span>Very Mild</span>
                                <span>Moderate</span>
                                <span>Very Intense</span>
                            </div>
                            <div class="slider-value" id="intensityValueMain">Moderate</div>
                        </div>
                    </div>
                </div>
            `;
        }
































        function createEmotionTreeInterface() {
            return `
                <div class="tree-container">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p>This interface uses <strong>Parrott's Emotion Classification</strong> system.</p>
                        <p>Navigate through three levels: Primary ‚Üí Secondary ‚Üí Tertiary emotions to find the most specific emotion that matches your experience.</p>
                    </div>
                    <div class="tree-level" id="treeLevel">
                        <!-- Tree content will be loaded here -->
                    </div>
                    <div class="breadcrumb" id="breadcrumb"></div>
                </div>
            `;
        }
































































        function createMetaphorInterface() {
            return `
                <div style="text-align: center; margin-bottom: 20px;">
                    <p>Choose metaphors that represent your feelings</p>
                </div>
                <h4>How's the weather in your mind?</h4>
                <div class="metaphor-grid">
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #fceabb 0%, #f8b500 100%);" onclick="selectMetaphor(this, 'sunny', 'weather')" data-category="weather">‚òÄÔ∏è<br>Sunny</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #d3d3d3 0%, #778899 100%);" onclick="selectMetaphor(this, 'cloudy', 'weather')" data-category="weather">‚òÅÔ∏è<br>Cloudy</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #a1c4fd 0%, #4682B4 100%);" onclick="selectMetaphor(this, 'rainy', 'weather')" data-category="weather">üåßÔ∏è<br>Rainy</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #6a76ab 0%, #2F4F4F 100%);" onclick="selectMetaphor(this, 'stormy', 'weather')" data-category="weather">‚õàÔ∏è<br>Stormy</div>
                </div>
                <h4>What color is your mood?</h4>
                <div class="metaphor-grid">
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #ff8177 0%, #ff2525 100%);" onclick="selectMetaphor(this, 'red', 'color')" data-category="color">üî¥<br>Red</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #a6c0fe 0%, #7699d4 100%);" onclick="selectMetaphor(this, 'blue', 'color')" data-category="color">üîµ<br>Blue</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);" onclick="selectMetaphor(this, 'green', 'color')" data-category="color">üü¢<br>Green</div>
                    <div class="metaphor-item" style="background: linear-gradient(135deg, #fdfc47 0%, #f9ca24 100%);" onclick="selectMetaphor(this, 'yellow', 'color')" data-category="color">üü°<br>Yellow</div>
                </div>
                <div class="input-group">
                    <label>Explain why these metaphors best represent your emotion:</label>
                    <textarea id="metaphorText" placeholder="e.g., 'It feels stormy inside because my thoughts are racing, and the mood is definitely red for anger...'"></textarea>
                </div>
            `;
        }
































































        function createFeelingsWheelInterface() {
            return `
                <div class="wheel-container">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p>This interface uses the <strong>Feelings Wheel</strong> approach.</p>
                        <p>Start with a core emotion in the center, then select more specific feelings as you move outward.</p>
                    </div>
                    <div class="wheel-level" id="wheelLevel">
                        <!-- Wheel content will be loaded here -->
                    </div>
                    <div class="wheel-breadcrumb" id="wheelBreadcrumb">
                        <strong>Selected:</strong> <span id="wheelPath">None</span>
                    </div>
                </div>
            `;
        }
































































        // Feelings Wheel Data Structure - Exactly as per the PDF
        const feelingsWheelData = {
            core: ['Happy', 'Sad', 'Disgusted', 'Angry', 'Fearful', 'Bad', 'Surprised'],
































            'Happy': {
                secondary: ['Playful', 'Content', 'Interested', 'Proud', 'Accepted', 'Powerful', 'Peaceful', 'Trusting', 'Optimistic'],
                tertiary: {
                    'Playful': ['Aroused', 'Cheeky'],
                    'Content': ['Free', 'Joyful'],
                    'Interested': ['Curious', 'Inquisitive'],
                    'Proud': ['Successful', 'Confident'],
                    'Accepted': ['Respected', 'Valued'],
                    'Powerful': ['Courageous', 'Creative'],
                    'Peaceful' : ['Loving', 'Thankful'],
                    'Trusting' : ['Sensitive', 'Intimate'], // Corrected typo 'Sesitive'
                    'Optimistic' : ['Hopeful', 'Inspired']
                }
            },
































            'Sad': {
                secondary: ['Lonely', 'Vulnerable', 'Despair', 'Guilty', 'Depressed', 'Hurt'],
                tertiary: {
                    'Lonely': ['Isolated', 'Abandoned'],
                    'Vulnerable': ['Victimized', 'Fragile'],
                    'Despair': ['Grieved', 'Powerless'],
                    'Guilty': ['Ashamed', 'Remorseful'],
                    'Depressed': ['Inferior', 'Empty'],
                    'Hurt': ['Embarrassed', 'Disappointed']
                }
            },
































            'Disgusted': {
                secondary: ['Disapproving', 'Disappointed', 'Awful', 'Repelled'],
                tertiary: {
                    'Disapproving': ['Judgemental', 'Embarrassed'], // Corrected typo 'Embaarrased'
                    'Disappointed': ['Appalled', 'Revolted'],
                    'Awful': ['Nauseated', 'Detestable'],
                    'Repelled': ['Horrified', 'Hesitant']
                }
            },
































            'Angry': {
                secondary: ['Let down', 'Humiliated', 'Bitter', 'Mad', 'Aggressive', 'Frustrated', 'Distant', 'Critical'],
                tertiary: {
                    'Let down': ['Betrayed', 'Resentful'],
                    'Humiliated': ['Disrespected', 'Ridiculed'],
                    'Bitter': ['Indignant', 'Violated'],
                    'Mad': ['Furious', 'Jealous'],
                    'Aggressive': ['Provoked', 'Hostile'],
                    'Frustrated': ['Infuriated', 'Annoyed'],
                    'Distant': ['Withdrawn', 'Numb'],
                    'Critical': ['Skeptical', 'Dismissive']
                }
            },
































            'Fearful': {
                secondary: ['Scared', 'Anxious', 'Insecure', 'Weak', 'Rejected', 'Threatened'],
                tertiary: {
                    'Scared': ['Helpless', 'Frightened'],
                    'Anxious': ['Overwhelmed', 'Worried'],
                    'Insecure': ['Inadequate', 'Inferior'],
                    'Weak': ['Worthless', 'Insignificant'],
                    'Rejected': ['Excluded', 'Persecuted'],
                    'Threatened': ['Nervous', 'Exposed']
                }
            },
































            'Bad': {
                secondary: ['Bored', 'Busy', 'Stressed', 'Tired'],
                tertiary: {
                    'Bored': ['Indifferent', 'Apathetic'],
                    'Busy': ['Pressured', 'Rushed'],
                    'Stressed': ['Overwhelmed', 'Out of control'],
                    'Tired': ['Sleepy', 'Unfocussed']
                }
            },
































            'Surprised': {
                secondary: ['Startled', 'Confused', 'Amazed', 'Excited'],
                tertiary: {
                    'Startled': ['Shocked', 'Dismayed'],
                    'Confused': ['Disillusioned', 'Perplexed'],
                    'Amazed': ['Astonished', 'Awe'],
                    'Excited': ['Eager', 'Energetic']
                }
            }
        };
































































        let wheelSelection = {
            core: null,
            secondary: null,
            tertiary: null
        };
































































        function setupFeelingsWheel() {
            wheelSelection = {
                core: null,
                secondary: null,
                tertiary: null
            };
            loadWheelLevel('core');
        }
































        function loadWheelLevel(level) {
            const container = document.getElementById('wheelLevel');
            
            if (level === 'core') {
                container.innerHTML = `
                    <h4 style="color: #4facfe; margin-bottom: 20px;">Step 1: Select a Core Emotion</h4>
                    <div class="core-emotions-grid">
                        ${feelingsWheelData.core.map((emotion) => `
                            <div class="core-emotion emotion-${emotion.toLowerCase()}" 
                                 onclick="selectCoreEmotion(this, '${emotion}')">
                                ${emotion}
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (level === 'secondary' && wheelSelection.core) {
                const secondaryEmotions = feelingsWheelData[wheelSelection.core].secondary;
                const coreColor = getEmotionColor(wheelSelection.core);
                
                container.innerHTML = `
                    <h4 style="color: #4facfe; margin-bottom: 20px;">Step 2: Select a Secondary Emotion for "${wheelSelection.core}"</h4>
                    <div class="secondary-emotions-grid">
                        ${secondaryEmotions.map((emotion) => `
                            <div class="secondary-emotion" 
                                 style="background: ${coreColor};"
                                 onclick="selectSecondaryEmotion(this, '${emotion}')">
                                ${emotion}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-secondary" onclick="backToCore()" style="margin-top: 20px;">Back to Core Emotions</button>
                `;
            } else if (level === 'tertiary' && wheelSelection.secondary) {
                const tertiaryEmotions = feelingsWheelData[wheelSelection.core].tertiary[wheelSelection.secondary] || [];
                
                container.innerHTML = `
                    <h4 style="color: #4facfe; margin-bottom: 20px;">Step 3: Select a Specific Emotion for "${wheelSelection.secondary}"</h4>
                    <div class="tertiary-emotions">
                        ${tertiaryEmotions.map(emotion => `
                            <div class="tertiary-emotion" 
                                 onclick="selectTertiaryEmotion(this, '${emotion}')">
                                ${emotion}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-secondary" onclick="backToSecondary()" style="margin-top: 20px;">Back to Secondary Emotions</button>
                `;
            }
            
            updateWheelBreadcrumb();
        }
































































        function getEmotionColor(emotion) {
            const colors = {
                'Happy': '#FFD700',
                'Sad': '#4169E1',
                'Disgusted': '#556b2f',
                'Angry': '#DC143C',
                'Fearful': '#483d8b',
                'Bad': '#708090',
                'Surprised': '#ff69b4'
            };
            return colors[emotion] || '#666'; // Default color
        }
































































        window.selectCoreEmotion = function(element, emotion) {
            // Remove previous selection
            document.querySelectorAll('.core-emotion').forEach(el => el.classList.remove('selected'));
            
            // Add selection to the clicked element
            element.classList.add('selected');
            
            wheelSelection.core = emotion;
            wheelSelection.secondary = null;
            wheelSelection.tertiary = null;
            
            // Wait for visual feedback then load next level
            setTimeout(() => loadWheelLevel('secondary'), 300);
        }
































































        window.selectSecondaryEmotion = function(element, emotion) {
            // Remove previous selection
            document.querySelectorAll('.secondary-emotion').forEach(el => el.classList.remove('selected'));
            
            // Add selection to the clicked element
            element.classList.add('selected');
            
            wheelSelection.secondary = emotion;
            wheelSelection.tertiary = null;
            
            const hasTertiary = feelingsWheelData[wheelSelection.core].tertiary[emotion] && 
                                feelingsWheelData[wheelSelection.core].tertiary[emotion].length > 0;
            
            if (hasTertiary) {
                setTimeout(() => loadWheelLevel('tertiary'), 300);
            } else {
                updateWheelBreadcrumb();
                setTimeout(() => showWheelCompletion(), 300);
            }
        }
































































        window.selectTertiaryEmotion = function(element, emotion) {
            // Remove previous selection
            document.querySelectorAll('.tertiary-emotion').forEach(el => el.classList.remove('selected'));
            
            // Add selection to the clicked element
            element.classList.add('selected');
            
            wheelSelection.tertiary = emotion;
            updateWheelBreadcrumb();
            
            setTimeout(() => showWheelCompletion(), 300);
        }
        
        function updateWheelBreadcrumb() {
            const path = [wheelSelection.core, wheelSelection.secondary, wheelSelection.tertiary].filter(Boolean);
            document.getElementById('wheelPath').textContent = path.length ? path.join(' ‚Üí ') : 'None';
        }
































































        function showWheelCompletion() {
            const container = document.getElementById('wheelLevel');
            const fullPath = [wheelSelection.core, wheelSelection.secondary, wheelSelection.tertiary].filter(Boolean).join(' ‚Üí ');
                
            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h3 style="color: #4caf50;">Emotion Selected!</h3>
                    <div style="font-size: 20px; margin: 30px 0; padding: 20px; background: #f0f8ff; border-radius: 12px;">
                        <strong>${fullPath}</strong>
                    </div>
                    <button class="btn btn-secondary" onclick="setupFeelingsWheel()">Start Over</button>
                </div>
            `;
            updateWheelBreadcrumb();
        }
































        window.backToCore = function() {
            wheelSelection.core = null;
            wheelSelection.secondary = null;
            wheelSelection.tertiary = null;
            loadWheelLevel('core');
        }
































































        window.backToSecondary = function() {
            wheelSelection.tertiary = null;
            loadWheelLevel('secondary');
        }
















































        function createEmojiInterface() {
            return `
                <div style="text-align: center; margin-bottom: 20px;">
                    <p>Select all the emojis that represent your emotional state. You can choose more than one.</p>
                </div>
                <div class="emoji-grid">
                    <div class="emoji-item" data-emotion="very-happy" onclick="toggleEmoji(this)">
                        üòÑ
                        <div class="emoji-label">Very Happy</div>
                    </div>
                    <div class="emoji-item" data-emotion="happy" onclick="toggleEmoji(this)">
                        üòä
                        <div class="emoji-label">Happy</div>
                    </div>
                    <div class="emoji-item" data-emotion="neutral" onclick="toggleEmoji(this)">
                        üòê
                        <div class="emoji-label">Neutral</div>
                    </div>
                    <div class="emoji-item" data-emotion="sad" onclick="toggleEmoji(this)">
                        üò¢
                        <div class="emoji-label">Sad</div>
                    </div>
                    <div class="emoji-item" data-emotion="angry" onclick="toggleEmoji(this)">
                        üò†
                        <div class="emoji-label">Angry</div>
                    </div>
                    <div class="emoji-item" data-emotion="anxious" onclick="toggleEmoji(this)">
                        üò∞
                        <div class="emoji-label">Anxious</div>
                    </div>
                    <div class="emoji-item" data-emotion="surprised" onclick="toggleEmoji(this)">
                        üò≤
                        <div class="emoji-label">Surprised</div>
                    </div>
                    <div class="emoji-item" data-emotion="love" onclick="toggleEmoji(this)">
                        üòç
                        <div class="emoji-label">Love/Affection</div>
                    </div>
                    <div class="emoji-item" data-emotion="excited" onclick="toggleEmoji(this)">
                        ü§©
                        <div class="emoji-label">Excited</div>
                    </div>
                    <div class="emoji-item" data-emotion="calm" onclick="toggleEmoji(this)">
                        üòå
                        <div class="emoji-label">Calm</div>
                    </div>
                    <div class="emoji-item" data-emotion="tired" onclick="toggleEmoji(this)">
                        üò¥
                        <div class="emoji-label">Tired</div>
                    </div>
                    <div class="emoji-item" data-emotion="confused" onclick="toggleEmoji(this)">
                        üòï
                        <div class="emoji-label">Confused</div>
                    </div>
                </div>
                <div class="intensity-slider" style="margin-top: 30px;">
                    <label>How intense are these feelings overall? (1 = very mild, 10 = very intense)</label>
                    <input type="range" class="slider" id="emojiIntensitySlider" min="1" max="10" value="5" oninput="updateEmojiIntensityValue()">
                    <div class="slider-value" id="emojiIntensityValue">5</div>
                </div>
            `;
        }
















        // More user-friendly ABC Journaling interface
        function createJournalingABCInterface() {
            return `
                <div style="text-align: left; margin-bottom: 20px;">
                    <p>This method helps you understand your emotions by looking at the trigger, your thoughts, and the resulting feelings. Please reflect on the scenario and fill out the fields below.</p>
                </div>
                <div class="input-group">
                    <label for="abcA"><strong>A - The Trigger:</strong> What event or situation led to this feeling?</label>
                    <textarea id="abcA" placeholder="Describe what happened. e.g., 'The appointment I was waiting for was cancelled at the last minute.'"></textarea>
                </div>
                <div class="input-group">
                    <label for="abcB"><strong>B - Your Beliefs:</strong> What thoughts or beliefs went through your mind?</label>
                    <textarea id="abcB" placeholder="What was your internal reaction? e.g., 'This is so unfair, my time isn't respected.' or 'They must think I'm not important.'"></textarea>
                </div>
                <div class="input-group">
                    <label for="abcC"><strong>C - The Consequence:</strong> How did you feel emotionally and physically?</label>
                    <textarea id="abcC" placeholder="Describe the feeling. e.g., 'I felt a surge of frustration and my shoulders tensed up.' or 'I felt my heart sink and a wave of disappointment.'"></textarea>
                </div>
            `;
        }
















        // New function for Contextual Factors interface
        function createContextualFactorsInterface() {
            const emotions = ['Happy', 'Sad', 'Angry', 'Anxious', 'Excited', 'Calm', 'Frustrated', 'Content'];
            const factors = [
                { label: 'Sleep Quality', icon: 'üò¥', key: 'sleep' },
                { label: 'Social Interaction', icon: 'üë•', key: 'social' },
                { label: 'Food & Drink', icon: 'üçî', key: 'food' },
                { label: 'Physical Activity', icon: 'üèÉ‚Äç‚ôÄÔ∏è', key: 'activity' },
                { label: 'Work/Tasks', icon: 'üíº', key: 'work' },
                { label: 'Weather', icon: '‚òÄÔ∏è', key: 'weather' },
                { label: 'Location', icon: 'üìç', key: 'location' },
                { label: 'Health', icon: '‚ù§Ô∏è', key: 'health' }
            ];
















            return `
                <div style="text-align: left; margin-bottom: 30px;">
                    <h4 style="color: #4facfe;">Step 1: What do you feel after reading this scenario?</h4>
                    <p>Select one or more core feelings.</p>
                    <div class="emotion-grid">
                        ${emotions.map(emotion => 
                            `<button class="emotion-btn" onclick="toggleEmotion(this, '${emotion}')">${emotion}</button>`
                        ).join('')}
                    </div>
                </div>
                <div style="text-align: left; margin-bottom: 20px;">
                    <h4 style="color: #4facfe;">Step 2: What factors might be influencing the emotions you felt for the imagined scenario?</h4>
                    <p>Select all that apply.</p>
                    <div class="context-grid">
                        ${factors.map(factor => `
                            <div class="context-item" data-key="${factor.key}" onclick="toggleContextItem(this)">
                                <div class="context-icon">${factor.icon}</div>
                                <div class="context-label">${factor.label}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                 <div class="input-group">
                    <label for="contextNotes">Optional Notes (anything else to add about the emotions you felt?)</label>
                    <textarea id="contextNotes" placeholder="e.g., 'Had a positive meeting with my boss', 'Feeling tired from a long week'..."></textarea>
                </div>
            `;
        }
































        // Interface-specific handlers
        window.toggleEmotion = function(btn, emotion) {
            btn.classList.toggle('selected');
        }
















        window.toggleContextItem = function(element) {
            element.classList.toggle('selected');
        }
































        window.updateIntensityValue = function() {
            const slider = document.getElementById('intensitySlider');
            const value = document.getElementById('intensityValue');
            value.textContent = slider.value;
        }
































































        window.updateEmojiIntensityValue = function() {
            const slider = document.getElementById('emojiIntensitySlider');
            const value = document.getElementById('emojiIntensityValue');
            value.textContent = slider.value;
        }
































        window.toggleEmoji = function(element) {
            element.classList.toggle('selected');
        }
































        window.selectQuadrant = function(element, plotId) {
            const plot = document.getElementById(plotId);
            
            // Remove 'selected' from all quadrants within this plot
            const allQuadrants = plot.querySelectorAll('.quadrant');
            allQuadrants.forEach(q => q.classList.remove('selected'));
            
            // Add 'selected' to the clicked quadrant
            element.classList.add('selected');
            
            // Store the selected quadrant name on the parent plot container
            plot.dataset.selectedQuadrant = element.dataset.quadrant;
        }
































































        function setupSliders() {
            // Sliders are ready to use
        }
















































        window.updateSliderValue = function(sliderType) {
            let slider, valueElement, newText;
            
            switch(sliderType) {
                case 'happy':
                    slider = document.getElementById('happySlider');
                    valueElement = document.getElementById('happyValue');
                    const happyValue = parseInt(slider.value);
                    if (happyValue < -30) newText = 'Very Negative';
                    else if (happyValue < -10) newText = 'Negative';
                    else if (happyValue < 10) newText = 'Neutral';
                    else if (happyValue < 30) newText = 'Positive';
                    else newText = 'Very Positive';
                    break;
                    
                case 'intensity':
                    slider = document.getElementById('intensitySliderMain');
                    valueElement = document.getElementById('intensityValueMain');
                    const intensityValue = parseInt(slider.value);
                    if (intensityValue < 20) newText = 'Very Mild';
                    else if (intensityValue < 40) newText = 'Mild';
                    else if (intensityValue < 60) newText = 'Moderate';
                    else if (intensityValue < 80) newText = 'Strong';
                    else newText = 'Very Intense';
                    break;
            }
            
            valueElement.textContent = newText;
        }
































        // Emotion Tree Functions - Using Parrott's Emotion Classification
        const emotionTree = {
            0: ['Love', 'Joy', 'Surprise', 'Anger', 'Suffering', 'Fear'],
            // Love and its secondary/tertiary emotions
            'Love': ['Affection', 'Lust', 'Longing'],
            'Affection': ['Adoration', 'Fondness', 'Liking', 'Attraction', 'Caring', 'Tenderness', 'Compassion', 'Sentimentality'],
            'Lust': ['Arousal', 'Desire', 'Passion', 'Infatuation'],
            'Longing': ['Longing'],
            
            // Joy and its secondary/tertiary emotions
            'Joy': ['Cheerfulness', 'Zest', 'Contentment', 'Pride', 'Optimism', 'Enthrallment', 'Relief'],
            'Cheerfulness': ['Amusement', 'Bliss', 'Gaiety', 'Glee', 'Jolliness', 'Joviality', 'Joy', 'Delight', 'Enjoyment', 'Gladness', 'Happiness', 'Jubilation', 'Elation', 'Satisfaction', 'Ecstasy', 'Euphoria'],
            'Zest': ['Enthusiasm', 'Zeal', 'Excitement', 'Thrill', 'Exhilaration'],
            'Contentment': ['Pleasure'],
            'Pride': ['Triumph'],
            'Optimism': ['Eagerness', 'Hope'],
            'Enthrallment': ['Enthrallment', 'Rapture'],
            'Relief': ['Relief'],
            
            // Surprise and its secondary/tertiary emotions
            'Surprise': ['Surprise'],
            'Surprise' : ['Amazement', 'Astonishment'],
            
            // Anger and its secondary/tertiary emotions
            'Anger': ['Irritation', 'Exasperation', 'Rage', 'Disgust', 'Envy', 'Torment'],
            'Irritation': ['Aggravation', 'Agitation', 'Annoyance', 'Grouchiness', 'Grumpiness'],
            'Exasperation': ['Frustration'],
            'Rage': ['Anger', 'Outrage', 'Fury', 'Wrath', 'Hostility', 'Ferocity', 'Bitterness', 'Hate', 'Loathing', 'Scorn', 'Spite', 'Vengefulness', 'Dislike', 'Resentment'],
            'Disgust': ['Disgust', 'Revulsion', 'Contempt'],
            'Envy': ['Jealousy'],
            'Torment': ['Torment'],
            
            // Sadness and its secondary/tertiary emotions
            'Suffering': ['Suffering', 'Sadness', 'Disappointment', 'Shame', 'Neglect', 'Sympathy'],
            'Suffering': ['Agony', 'Hurt', 'Anguish'],
            'Sadness': ['Depression', 'Despair', 'Hopelessness', 'Gloom', 'Glumness', 'Unhappiness', 'Grief', 'Sorrow', 'Woe', 'Misery', 'Melancholy'],
            'Disappointment': ['Dismay', 'Displeasure'],
            'Shame': ['Guilt', 'Regret', 'Remorse'],
            'Neglect': ['Alienation', 'Isolation', 'Loneliness', 'Rejection', 'Homesickness', 'Defeat', 'Dejection', 'Insecurity', 'Embarrassment', 'Humiliation', 'Insult'],
            'Sympathy': ['Pity', 'Sympathy'],
            
            // Fear and its secondary/tertiary emotions
            'Fear': ['Horror', 'Nervousness'],
            'Horror': ['Alarm', 'Shock', 'Fear', 'Fright', 'Terror', 'Panic', 'Hysteria', 'Mortification'],
            'Nervousness': ['Anxiety', 'Nervousness', 'Tenseness', 'Uneasiness', 'Apprehension', 'Worry', 'Distress', 'Dread']
        };
































































        let treeLevel = 0;
        let treePath = [];
































































        function setupEmotionTree() {
            treeLevel = 0;
            treePath = [];
            loadTreeLevel(0);
        }
































































        function loadTreeLevel(level) {
            const container = document.getElementById('treeLevel');
            const emotions = level === 0 ? emotionTree[0] : emotionTree[treePath[treePath.length - 1]];
            
            if (!emotions) {
                container.innerHTML = '<p style="text-align: center; color: #4caf50; font-weight: bold;">Selection Complete!</p>';
                return;
            }
            
            // Display level indicator
            let levelName = '';
            if (level === 0) levelName = 'Primary Emotions';
            else if (level === 1) levelName = 'Secondary Emotions';
            else if (level === 2) levelName = 'Tertiary Emotions';
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h4 style="color: #4facfe;">${levelName}</h4>
                </div>
                <div class="emotion-grid">
                    ${emotions.map(emotion => 
                        `<button class="emotion-btn" onclick="selectTreeEmotion('${emotion}')">${emotion}</button>`
                    ).join('')}
                </div>
            `;
            
            updateBreadcrumb();
        }
































































        window.selectTreeEmotion = function(emotion) {
            treePath.push(emotion);
            
            if (emotionTree[emotion]) {
                loadTreeLevel(treePath.length);
            } else {
                document.getElementById('treeLevel').innerHTML = 
                    `<p style="text-align: center; color: #4caf50; font-weight: bold;">
                        Selected: ${emotion}<br>
                        <small>This represents your most specific emotion</small>
                    </p>`;
                updateBreadcrumb();
            }
        }
































































        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = `<strong>Path:</strong> ${treePath.join(' ‚Üí ') || 'Start'}`;
        }
































































        // Metaphor Interface Functions
        let selectedMetaphors = {
            weather: null,
            color: null,
            description: ''
        };
































































        window.selectMetaphor = function(element, metaphor, category) {
            const categoryItems = document.querySelectorAll(`[data-category="${category}"]`);
            categoryItems.forEach(item => {
                item.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedMetaphors[category] = metaphor;
        }
































































        function setupMetaphorInterface() {
            selectedMetaphors = {
                weather: null,
                color: null,
                description: ''
            };
        }
































































        // Rating System
        function setupRatingStars() {
            document.querySelectorAll('.rating-stars').forEach(container => {
                const stars = container.querySelectorAll('.star');
                stars.forEach(star => {
                    star.addEventListener('click', function() {
                        const rating = this.dataset.value;
                        
                        this.closest('.rating-row').classList.remove('rating-required-error');
                        
                        stars.forEach((s, index) => {
                            if (index < rating) {
                                s.classList.add('active');
                            } else {
                                s.classList.remove('active');
                            }
                        });
                        
                        container.dataset.selectedRating = rating;
                    });
                });
            });
        }
































































        function resetRatings() {
            // Reset all star ratings
            document.querySelectorAll('.rating-stars').forEach(container => {
                container.dataset.selectedRating = '';
                const stars = container.querySelectorAll('.star');
                stars.forEach(star => {
                    star.classList.remove('active');
                });
                container.closest('.rating-row').classList.remove('rating-required-error');
            });
            
            document.getElementById('interfaceLikes').value = '';
            document.getElementById('interfaceDislikes').value = '';
        }
































































        // Navigation Functions
        window.nextStep = function() {
            if (currentStep === 0) {
                collectInterfaceResponse();
                currentStep = 1;
                document.getElementById('ratingSection').style.display = 'block';
                document.getElementById('nextBtn').textContent = 'Next Interface';
                document.getElementById('backBtn').style.display = 'inline-block'; // or 'block'
                setupRatingStars();
                document.getElementById('ratingSection').scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                let allRatingsProvided = true;
                const ratingContainers = document.querySelectorAll('.rating-stars');
                
                ratingContainers.forEach(container => {
                    const ratingRow = container.closest('.rating-row');
                    ratingRow.classList.remove('rating-required-error'); 
                    if (!container.dataset.selectedRating) {
                        allRatingsProvided = false;
                        ratingRow.classList.add('rating-required-error');
                    }
                });
















                if (!allRatingsProvided) {
                    alert('Please provide a star rating for all categories (Ease of Use, Accuracy, and Preference) before continuing.');
                    return;
                }
















                collectRatings();
                currentInterface++;
                resetRatings(); 
                loadInterface();
            }
        }
























        window.previousStep = function() {
            if (currentStep === 1) {
                currentStep = 0;
                document.getElementById('ratingSection').style.display = 'none';
                document.getElementById('nextBtn').textContent = 'Continue';
                document.getElementById('backBtn').style.display = 'none';
            }
        }
















        function collectInterfaceResponse() {
            const interfaceDef = shuffledInterfaces[currentInterface];
            const scenario = sessionTaskScenarios[currentInterface];
            const startTime = Date.now();
            
            let responseData = {
                interface_type: interfaceDef.type,
                interface_name: interfaceDef.name,
                scenario: scenario,
                timestamp: new Date().toISOString(),
                response_time_ms: startTime - (surveyData.lastStepTime || surveyData.startTime)
            };
















            switch(interfaceDef.type) {
                case 'basic_labels':
                    const selectedEmotions = Array.from(document.querySelectorAll('.emotion-btn.selected')).map(btn => btn.textContent);
                    responseData.selected_emotions = selectedEmotions;
                    responseData.intensity = document.getElementById('intensitySlider').value;
                    break;
                    
                case 'va_technical':
                    const vaTechnicalPlot = document.getElementById('vaTechnicalPlot');
                    responseData.selected_quadrant = vaTechnicalPlot.dataset.selectedQuadrant;
                    responseData.plot_type = 'technical';
                    break;
                    
                case 'va_simple':
                    const vaSimplePlot = document.getElementById('vaSimplePlot');
                    responseData.selected_quadrant = vaSimplePlot.dataset.selectedQuadrant;
                    responseData.plot_type = 'simple'; // REVERTED
                    break;
                
                case 'emotion_sliders':
                    responseData.valence_value = document.getElementById('happySlider').value;
                    responseData.intensity_value = document.getElementById('intensitySliderMain').value;
                    responseData.valence_label = document.getElementById('happyValue').textContent;
                    responseData.intensity_label = document.getElementById('intensityValueMain').textContent;
                    break;
                    
                case 'emotion_tree':
                    responseData.emotion_path = treePath;
                    responseData.final_emotion = treePath[treePath.length - 1];
                    break;
                    
                case 'metaphor':
                    responseData.selected_weather = selectedMetaphors.weather;
                    responseData.selected_color = selectedMetaphors.color;
                    responseData.metaphor_description = document.getElementById('metaphorText').value;
                    break;
                
                case 'emoji':
                    const selectedEmojis = Array.from(document.querySelectorAll('.emoji-item.selected')).map(el => el.dataset.emotion);
                    responseData.selected_emojis = selectedEmojis;
                    responseData.emoji_intensity = document.getElementById('emojiIntensitySlider').value;
                    break;
                    
                case 'feelings_wheel':
                    responseData.wheel_path = {
                        core: wheelSelection.core,
                        secondary: wheelSelection.secondary,
                        tertiary: wheelSelection.tertiary
                    };
                    responseData.final_emotion = wheelSelection.tertiary || wheelSelection.secondary || wheelSelection.core;
                    break;
                
                case 'journaling_abc':
                    responseData.activating_event = document.getElementById('abcA').value;
                    responseData.beliefs = document.getElementById('abcB').value;
                    responseData.consequence_emotion = document.getElementById('abcC').value;
                    break;
















                case 'contextual_factors':
                    const contextEmotions = Array.from(document.querySelectorAll('.emotion-btn.selected')).map(btn => btn.textContent);
                    const contextFactors = Array.from(document.querySelectorAll('.context-item.selected')).map(item => item.dataset.key);
                    responseData.selected_emotions = contextEmotions;
                    responseData.selected_factors = contextFactors;
                    responseData.notes = document.getElementById('contextNotes').value;
                    break;
            }
















            surveyData.responses.push(responseData);
            surveyData.lastStepTime = Date.now();
        }
















        function collectRatings() {
            const currentResponse = surveyData.responses[surveyData.responses.length - 1];
            
            const easeRating = document.querySelector('[data-rating="ease"]').dataset.selectedRating;
            const accuracyRating = document.querySelector('[data-rating="accuracy"]').dataset.selectedRating;
            const preferenceRating = document.querySelector('[data-rating="preference"]').dataset.selectedRating;
            
            currentResponse.ratings = {
                ease_of_use: parseInt(easeRating) || 0,
                accuracy: parseInt(accuracyRating) || 0,
                preference: parseInt(preferenceRating) || 0,
                likes: document.getElementById('interfaceLikes').value,
                dislikes: document.getElementById('interfaceDislikes').value
            };
        }








        function updateProgress() {
            const progress = ((currentInterface) / shuffledInterfaces.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }








        // Final Feedback Functions
        function showFinalFeedback() {
            document.getElementById('mainInterface').classList.add('hidden');
            document.getElementById('finalFeedbackScreen').classList.remove('hidden');
            
            // MODIFICATION: Scroll to the top of the final feedback screen
            document.getElementById('finalFeedbackScreen').scrollIntoView({ behavior: 'smooth', block: 'start' });


            // Update progress to show completion
            document.getElementById('progressFill').style.width = '100%';
            
            // Populate interface list
            const interfaceList = document.getElementById('interfaceList');
            interfaceList.innerHTML = `
                <ul style="margin: 15px 0; padding-left: 20px;">
                    ${shuffledInterfaces.map((interfaceDef, index) => 
                        `<li style="margin: 5px 0;"><strong>${index + 1}.</strong> ${interfaceDef.name}</li>`
                    ).join('')}
                </ul>
            `;
            
            // Populate best interface radio buttons
            const bestInterfaceGroup = document.getElementById('bestInterfaceGroup');
            bestInterfaceGroup.innerHTML = shuffledInterfaces.map((interfaceDef, index) => `
                <div class="radio-item">
                    <input type="radio" name="bestInterface" value="${interfaceDef.type}" id="best-${interfaceDef.type}">
                    <label for="best-${interfaceDef.type}">${interfaceDef.name}</label>
                </div>
            `).join('');
            
            // Populate worst interface radio buttons
            const worstInterfaceGroup = document.getElementById('worstInterfaceGroup');
            worstInterfaceGroup.innerHTML = shuffledInterfaces.map((interfaceDef, index) => `
                <div class="radio-item">
                    <input type="radio" name="worstInterface" value="${interfaceDef.type}" id="worst-${interfaceDef.type}">
                    <label for="worst-${interfaceDef.type}">${interfaceDef.name}</label>
                </div>
            `).join('');
        }








        window.goBackToMainInterface = function() {
            document.getElementById('finalFeedbackScreen').classList.add('hidden');
            document.getElementById('mainInterface').classList.remove('hidden');
            
            // Reset to last interface
            currentInterface = shuffledInterfaces.length - 1;
            currentStep = 1; // Go back to the rating step of the last interface
            loadInterface();
        }








        window.submitFinalFeedback = async function() {
            // Validate required fields
            const bestInterface = document.querySelector('input[name="bestInterface"]:checked');
            const worstInterface = document.querySelector('input[name="worstInterface"]:checked');
            const usageContext = document.querySelector('input[name="usageContext"]:checked');
            
            if (!bestInterface) {
                alert('Please select your most preferred interface.');
                return;
            }
            
            if (!worstInterface) {
                alert('Please select your least preferred interface.');
                return;
            }
            
            if (bestInterface.value === worstInterface.value) {
                alert('Please select different interfaces for best and worst preferences.');
                return;
            }
            
            if (!usageContext) {
                alert('Please select a usage context.');
                return;
            }
            
            // Collect final feedback data
            surveyData.finalFeedback = {
                best_interface: bestInterface.value,
                best_interface_reason: document.getElementById('bestInterfaceReason').value,
                worst_interface: worstInterface.value,
                worst_interface_reason: document.getElementById('worstInterfaceReason').value,
                general_improvements: document.getElementById('generalImprovements').value,
                usage_context: usageContext.value,
                additional_comments: document.getElementById('additionalComments').value,
                feedback_timestamp: new Date().toISOString()
            };
            
            // Calculate total study time
            surveyData.total_time_minutes = Math.round((Date.now() - surveyData.startTime) / 1000 / 60);
            
            const submitBtn = document.querySelector('#finalFeedbackScreen button.btn-primary');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';




            try {
                // Save data to Firebase
                await addDoc(collection(db, "study-responses"), surveyData);
                showResults(true); // Success
            } catch (error) {
                console.error("Firebase save error: ", error);
                showResults(false); // Failure
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Complete Study';
            }
        }


        // <!-- MODIFICATION START: Added a new function to handle copying data on error -->
        window.copyDataToClipboard = function() {
            const textarea = document.getElementById('errorDataTextarea');
            const copyBtn = document.getElementById('copyDataBtn');

            // Select the text
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            // Use the Clipboard API
            navigator.clipboard.writeText(textarea.value).then(() => {
                // Success feedback
                copyBtn.textContent = 'Copied!';
                copyBtn.disabled = true;
                setTimeout(() => {
                    copyBtn.textContent = 'Copy Data to Clipboard';
                    copyBtn.disabled = false;
                }, 3000); // Reset after 3 seconds
            }).catch(err => {
                // Error feedback
                console.error('Failed to copy text: ', err);
                copyBtn.textContent = 'Copy Failed!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy Data to Clipboard';
                }, 3000);
            });
        }
        // <!-- MODIFICATION END -->


        function showResults(isSuccess = true) {
            document.getElementById('finalFeedbackScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const resultsContent = document.getElementById('resultsContent');


            if (isSuccess) {
                resultsContent.innerHTML = `
                    <h2>üéâ Thank You!</h2>
                    <p>Your responses have been successfully submitted.</p>
                    <p>This data is invaluable and will help us improve emotion tracking interfaces. You can now close this window.</p>
                `;
            } else {
                // <!-- MODIFICATION START: Updated failure message with a copy button -->
                resultsContent.innerHTML = `
                    <h2>Submission Failed</h2>
                    <p>Unfortunately, there was an error saving your responses. We apologize for the inconvenience.</p>
                    
                    <p style="margin-top: 15px;"><strong>Please click the button to copy your data, then paste it into an email to our research team at pragyas@iiitd.ac.in.</strong></p>
                    <div style="margin-top: 20px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #f9f9f9;">
                        <h4>Your Data:</h4>
                        <textarea readonly id="errorDataTextarea" style="width: 100%; height: 200px; font-family: monospace; font-size: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-top: 10px; resize: none;">
${JSON.stringify(surveyData, null, 2)}
                        </textarea>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-primary" id="copyDataBtn" onclick="copyDataToClipboard()">Copy Data to Clipboard</button>
                        </div>
                    </div>
                `;
                // <!-- MODIFICATION END -->
            }
        }


    </script>
</body>
</html>
